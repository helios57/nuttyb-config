# Developer Guidelines (AGENTS.md)

This file contains instructions and context for AI agents and developers working on the NuttyB Configurator.

## Project Overview
NuttyB Configurator is a tool for generating configuration files (tweaks) for the Beyond All Reason (BAR) game engine (Spring Engine). It uses a custom TypeScript DSL to define tweaks and compiles them into optimized Lua code.

## Environment & Tooling
- **Node.js**: The project requires **Node.js v25** or later.
- **GitHub Actions**: Workflows use **v6** versions of actions (e.g., `actions/checkout@v6`, `actions/setup-node@v6`).
- **Package Manager**: npm.

## Architecture
- **Compiler**: The core logic resides in `src/mod-logic/optimized-compiler.ts`. Do not use or refer to the legacy `lua-compiler.ts`.
- **DSL**: Tweak definitions use strict TypeScript types defined in `src/mod-logic/tweak-dsl.ts`.
- **Optimization**: The compiler implements optimizations like upvalue localization (e.g., `local math_floor = math.floor`) and loop fusion.

## Code Organization
- `src/`: Source code.
- `tests/`: Unit tests. Excluded from `tsconfig.json` to prevent build errors.
- `release/`: Generated by `npm run package`, contains the deployment artifact.

## Testing
- Run tests using `npm test`.
- Tests run with `NODE_OPTIONS=--experimental-vm-modules` because they involve ESM and `wasmoon` (WebAssembly Lua environment).

## Release Process
- **Versioning & Changelog**: The project uses `standard-version` to manage versioning and the changelog.
- **To Release**: Run `npm run release`. This will:
  1. Update `CHANGELOG.md` with changes from commits.
  2. Bump the version in `package.json`.
  3. Create a git tag.
- **Publishing**: After running the release script, push the changes and tags (`git push --follow-tags`). Then, manually create a Release in GitHub using the new tag. This triggers the deployment workflow (`deploy.yml`).

## Coding Conventions
- **Lua Generation**: Prefer generating code that uses local references for globals.
- **Performance**: The frontend uses `Map` and `Set` for rendering large lists.

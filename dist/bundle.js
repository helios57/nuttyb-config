(()=>{"use strict";const e={maps:[{name:"Full Metal Plate (12P)",commands:["!map Full Metal Plate","!addbox 82 82 117 117 2","!clearbox 1"]},{name:"Raptor Crater (16P)",commands:["!map Raptor Crater","!addbox 84 81 119 116 2","!clearbox 1","!teamsize 16"]},{name:"Raptor Crater Inverted (16P)",commands:["!map Raptor Crater","!disablemapdamage 0","!debugcommands invertmap","!addbox 84 81 119 116 2","!clearbox 1","!teamsize 16"]},{name:"Special Hotstepper (16P)",commands:["!map Special Hotstepper","!addbox 83 81 118 116 2","!clearbox 1","!map_lavatiderhythm disabled","!teamsize 16"]},{name:"To Kill The Middle (12P)",commands:["!map To Kill The Middle","!addbox 82 82 117 117 2","!clearbox 1","!teamsize 12"]},{name:"Ancient Bastion Remake (8P)",commands:["!map Ancient Bastion Remake","!addbox 0 0 100 200 1","!addbox 175 0 200 200 2","!teamsize 8"]},{name:"Ancient Vault (12P)",commands:["!map Ancient Vault","!addbox 0 0 200 120 1","!addbox 0 180 200 200 2","!teamsize 12"]},{name:"Bismuth Valley (8P)",commands:["!map Bismuth Valley","!addbox 0 0 64 200 1","!addbox 175 0 200 200 2","!teamsize 8"]},{name:"Darkside (12P)",commands:["!map Darkside","!addbox 0 0 64 200 1","!addbox 175 0 200 200 2","!teamsize 12"]},{name:"Flats and Forests (12P)",commands:["!map Flats and Forests","!addbox 0 0 64 200 1","!addbox 175 0 200 200 2","!teamsize 12"]},{name:"Special Creek (12P)",commands:["!map Special Creek","!addbox 158 0 200 200 2","!teamsize 12"]},{name:"Starwatcher (8P)",commands:["!map Starwatcher","!addbox 0 0 64 200 1","!addbox 175 0 200 200 2","!teamsize 8"]}],modes:[{name:"No Rush",commands:["!raptor_queentimemult 1.3","!raptor_spawncountmult 3","!raptor_firstwavesboost 6","!raptor_graceperiodmult 3"]},{name:"No Rush Solo",commands:["!raptor_queentimemult 1.3","!raptor_spawncountmult 3","!raptor_firstwavesboost 3","!raptor_graceperiodmult 2.7"]},{name:"Zero Grace",commands:["!raptor_queentimemult 1.4","!raptor_spawncountmult 3","!raptor_firstwavesboost 3","!raptor_graceperiodmult 0.1"]},{name:"Surrounded",commands:["!raptor_queentimemult 1.3","!raptor_spawncountmult 3","!raptor_firstwavesboost 6","!raptor_graceperiodmult 3","!addbox 60 60 140 140 1","!raptor_raptorstart avoid","!clearbox 2"]}],base:["!preset coop","!teamsize 12","!autobalance off","!assistdronesbuildpowermultiplier 1","!assistdronesenabled enabled","!commanderbuildersbuildpower 1000","!commanderbuildersenabled enabled","!commanderbuildersrange 1000","!disablemapdamage 1","!experimentalextraunits 1","!experimentallegionfaction 1","!experimentalshields bounceeverything","!maxunits 10000","!multiplier_builddistance 1.5","!multiplier_buildpower 1","!multiplier_buildtimecost 1","!multiplier_energyconversion 1","!multiplier_energycost 1","!multiplier_energyproduction 1","!multiplier_losrange 1","!multiplier_maxdamage 1","!multiplier_maxvelocity 1","!multiplier_metalcost 1","!multiplier_metalextraction 1","!multiplier_radarrange 1","!multiplier_resourceincome 1","!multiplier_shieldpower 2","!multiplier_turnrate 1","!multiplier_weapondamage 1","!multiplier_weaponrange 1","!raptor_difficulty epic","!raptor_spawntimemult 1","!releasecandidates 1","!startenergy 10000","!startenergystorage 10000","!startmetal 10000","!startmetalstorage 10000","!scavunitsforplayers 1","!forceallunits 1","!unit_restrictions_noair 0","!unit_restrictions_noendgamelrpc 0","!unit_restrictions_noextractors 1","!unit_restrictions_nolrpc 0","!unit_restrictions_nonukes 0","!draft_mode disabled","!unit_restrictions_notacnukes 0","$welcome-message Settings made with NuttyB Configurator https://rcorex.github.io/nuttyb-config/","!unit_market 0","!evocom 0","!nowasting all","!bSet unit_restrictions_nonukes 1","!bSet raptor_queen_count 8","!balance"],scavengers:["!scav_boss_count 8","!scav_bosstimemult 1.3","!scav_difficulty epic","!scav_spawncountmult 2","!bSet ruins disabled","!shieldsrework 1","!unit_restrictions_noextractors 0"]},t=[{label:"NuttyB Main Tweaks",type:"checkbox",column:"left",default:!0,commandBlocks:[]},{label:"NuttyB Evolving Commanders",type:"checkbox",column:"left",default:!1,commandBlocks:["!evocom 1"]},{label:"Mechanics & Balance",type:"checkbox",column:"left",default:!0,commandBlocks:[]},{label:"Cross Faction T2",type:"checkbox",column:"left",default:!1,commandBlocks:[]},{label:"T3 Eco",type:"checkbox",column:"left",default:!1,commandBlocks:[]},{label:"T3 Builders",type:"checkbox",column:"left",default:!1,commandBlocks:[]},{label:"Unit Launchers",type:"checkbox",column:"left",default:!1,commandBlocks:[],tweakTemplateId:"tweak_enable_unit_launchers"},{label:"LRPC Rebalance v2",type:"checkbox",column:"left",default:!1,commandBlocks:[]},{label:"T4 Defences Test",type:"checkbox",column:"left",default:!1,commandBlocks:[]},{label:"T4 Air Rework",type:"checkbox",column:"left",default:!1,commandBlocks:[]},{label:"Mega Nuke",type:"checkbox",column:"left",default:!1,commandBlocks:[]},{label:"Raptor Health",type:"select",isHpGenerator:!0,hpType:"hp",column:"left",slot:"",slotType:"tweakdefs",defaultValue:"1.3",choices:[{label:"Default",value:"",shortLabel:""},{label:"1x HP",value:"1",shortLabel:"1x HP"},{label:"1.3x HP",value:"1.3",shortLabel:"1_3x HP"},{label:"1.5x HP",value:"1.5",shortLabel:"1_5x HP"},{label:"1.7x HP",value:"1.7",shortLabel:"1_7x HP"},{label:"2x HP",value:"2",shortLabel:"2x HP"},{label:"2.5x HP",value:"2.5",shortLabel:"2_5x HP"},{label:"3x HP",value:"3",shortLabel:"3x HP"},{label:"4x HP",value:"4",shortLabel:"4x HP"},{label:"5x HP",value:"5",shortLabel:"5x HP"}]},{label:"Queen Health",type:"select",isHpGenerator:!0,hpType:"qhp",column:"left",slot:1,slotType:"tweakdefs",defaultValue:"1.3",choices:[{label:"Default",value:"",shortLabel:""},{label:"1x QHP",value:"1",shortLabel:"1x QHP"},{label:"1.3x QHP",value:"1.3",shortLabel:"1_3x QHP"},{label:"1.5x QHP",value:"1.5",shortLabel:"1_5x QHP"},{label:"1.7x QHP",value:"1.7",shortLabel:"1_7x QHP"},{label:"2x QHP",value:"2",shortLabel:"2x QHP"},{label:"2.5x QHP",value:"2.5",shortLabel:"2_5x QHP"},{label:"3x QHP",value:"3",shortLabel:"3x QHP"},{label:"4x QHP",value:"4",shortLabel:"4x QHP"},{label:"5x QHP",value:"5",shortLabel:"5x QHP"}]},{label:"Limit Max Allowed",type:"header",column:"left"},{label:"T3 Builders",type:"numeric-tweak",column:"left",defaultValue:"10",min:0,unitLabel:"max/unit",tweakTemplateId:"tweak_limit_t3builders",tweakVar:"limit"},{label:"Unit Launchers",type:"numeric-tweak",column:"left",defaultValue:"20",min:0,unitLabel:"max/unit",tweakTemplateId:"tweak_limit_unit_launchers",tweakVar:"limit"},{label:"Epic Ragnarok",type:"numeric-tweak",column:"left",defaultValue:"80",min:0,unitLabel:"max/unit",tweakTemplateId:"tweak_limit_epic_ragnarok",tweakVar:"limit"},{label:"Epic Calamity",type:"numeric-tweak",column:"left",defaultValue:"80",min:0,unitLabel:"max/unit",tweakTemplateId:"tweak_limit_epic_calamity",tweakVar:"limit"},{label:"Epic Tyrannus",type:"numeric-tweak",column:"left",defaultValue:"80",min:0,unitLabel:"max/unit",tweakTemplateId:"tweak_limit_epic_tyrannus",tweakVar:"limit"},{label:"Epic Starfall",type:"numeric-tweak",column:"left",defaultValue:"80",min:0,unitLabel:"max/unit",tweakTemplateId:"tweak_limit_epic_starfall",tweakVar:"limit"},{label:"Game Multipliers",type:"header",column:"left"},{label:"Resource Income",type:"numeric-tweak",column:"left",defaultValue:"1",min:0,step:.1,modOption:"multiplier_resourceincome"},{label:"Shield Power",type:"numeric-tweak",column:"left",defaultValue:"2",min:0,step:.1,modOption:"multiplier_shieldpower"},{label:"Build Range",type:"numeric-tweak",column:"left",defaultValue:"1.5",min:0,step:.1,modOption:"multiplier_builddistance"},{label:"Build Power",type:"numeric-tweak",column:"left",defaultValue:"1",min:0,step:.1,modOption:"multiplier_buildpower"},{label:"Raptor Settings",type:"header",column:"left"},{label:"Queen Quantity",type:"numeric-tweak",column:"left",defaultValue:"8",min:0,step:1,modOption:"raptor_queen_count"},{label:"Wave Multiplier",type:"numeric-tweak",column:"left",defaultValue:"1",min:0,step:.1,modOption:"raptor_spawncountmult"},{label:"First Waves Boost",type:"numeric-tweak",column:"left",defaultValue:"0",min:0,step:1,modOption:"raptor_firstwavesboost"},{label:"Grace Period Multiplier",type:"numeric-tweak",column:"left",defaultValue:"1",min:0,step:.1,modOption:"raptor_graceperiodmult"}];var a=function(e,t,a,s){return new(a||(a=Promise))(function(n,o){function l(e){try{r(s.next(e))}catch(e){o(e)}}function i(e){try{r(s.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,i)}r((s=s.apply(e,t||[])).next())})};function s(){return a(this,void 0,void 0,function*(){return{rawOptionsData:[],formOptionsConfig:t}})}function n(){return a(this,void 0,void 0,function*(){try{const e=yield fetch(`links.md?t=${Date.now()}`);if(!e.ok)return"";const t=yield e.text();return"undefined"!=typeof marked&&marked.parse?marked.parse(t):t}catch(e){return console.error("Failed to load links content",e),""}})}function o(t){return a(this,void 0,void 0,function*(){return e})}const l="nuttyb-custom-tweaks";let i=[];function r(e){i=e,localStorage.setItem(l,JSON.stringify(i))}function c(){return i}const d=JSON.parse('{"qhp":{"name":"Queen Health & Repair","description":"Queen Health & Repair Adjustments","scope":"UnitDefsLoop","conditions":[{"type":"nameStartsWith","prefix":"raptor_queen_"}],"mutations":[{"op":"set","field":"repairable","value":false},{"op":"set","field":"canbehealed","value":false},{"op":"set","field":"buildTime","value":9999999},{"op":"set","field":"autoHeal","value":2},{"op":"set","field":"canSelfRepair","value":false},{"op":"multiply","field":"health","factor":{"type":"variable","key":"multiplier"}}]},"raptor_swarmer_heal":{"name":"Swarmer Heal Adjustments","description":"Swarmer Heal adjustments","scope":"UnitDefsLoop","conditions":[{"type":"nameStartsWith","prefix":"raptor_land_swarmer_heal"}],"mutations":[{"op":"set","field":"reclaimSpeed","value":100},{"op":"set","field":"stealth","value":false},{"op":"set","field":"builder","value":false},{"op":"multiply","field":"buildSpeed","factor":{"type":"variable","key":"workertimeMultiplier"}},{"op":"set","field":"canAssist","value":false},{"op":"set","field":"maxThisUnit","value":0}]},"raptor_health":{"name":"Raptor Health Adjustments","description":"Raptor Health adjustments","scope":"UnitDefsLoop","conditions":[{"type":"customParam","key":"subfolder","value":"other/raptors"},{"type":"nameNotMatch","regex":"^raptor_queen_.*"}],"mutations":[{"op":"multiply","field":"health","factor":{"type":"variable","key":"healthMultiplier"}}]},"raptor_metal_chase":{"name":"Raptor Metal & Chase","description":"Metal Cost and NoChase","scope":"UnitDefsLoop","conditions":[{"type":"customParam","key":"subfolder","value":"other/raptors"}],"mutations":[{"op":"set","field":"noChaseCategory","value":"OBJECT"},{"op":"assign_math_floor","target":"metalCost","source":"health","factor":{"type":"variable","key":"metalCostFactor"}}]},"boss_hp":{"name":"Scav Boss HP","description":"Scavenger Boss HP adjustment","scope":"UnitDef_Post","conditions":[{"type":"nameStartsWith","prefix":"scavengerbossv4"}],"mutations":[{"op":"multiply","field":"health","factor":{"type":"variable","key":"multiplier"}}]},"scav_hp_health":{"name":"Scavengers HP - Health","description":"Scavenger Health","scope":"UnitDef_Post","conditions":[{"type":"nameEndsWith","suffix":"_scav"},{"type":"nameNotMatch","regex":"^scavengerbossv4"}],"mutations":[{"op":"assign_math_floor","target":"health","source":"health","factor":{"type":"variable","key":"multiplier"}}]},"scav_hp_metal":{"name":"Scavengers HP - Metal & Category","description":"Scavenger Metal Cost and Category","scope":"UnitDef_Post","conditions":[{"type":"nameEndsWith","suffix":"_scav"}],"mutations":[{"op":"assign_math_floor","target":"metalCost","source":"metalCost","factor":{"type":"variable","key":"multiplier"}},{"op":"set","field":"noChaseCategory","value":"OBJECT"}]},"add_to_build_menu":{"name":"Add Unit to Factory","description":"Adds unit to build options","scope":"UnitDefsLoop","conditions":[{"type":"nameStartsWith","prefix":{"type":"variable","key":"factoryPrefix"}}],"mutations":[{"op":"list_append","field":"buildoptions","value":{"type":"variable","key":"unitName"}}]},"tweak_limit_t3builders":{"name":"Limit T3 Builders","description":"Limits T3 Builders","scope":"UnitDefsLoop","conditions":[{"type":"nameInList","names":["armconst3","corconst3","legconst3"]}],"mutations":[{"op":"set","field":"maxThisUnit","value":{"type":"variable","key":"limit"}}]},"tweak_limit_unit_launchers":{"name":"Limit Unit Launchers","description":"Limits Unit Launchers","scope":"UnitDefsLoop","conditions":[{"type":"nameInList","names":["armmeatball","corclogger"]}],"mutations":[{"op":"set","field":"maxThisUnit","value":{"type":"variable","key":"limit"}}]},"tweak_limit_epic_ragnarok":{"name":"Limit Ragnarok","description":"Limits Epic Ragnarok","scope":"UnitDefsLoop","conditions":[{"type":"nameMatch","regex":"ragnarok"}],"mutations":[{"op":"set","field":"maxThisUnit","value":{"type":"variable","key":"limit"}}]},"tweak_limit_epic_calamity":{"name":"Limit Calamity","description":"Limits Epic Calamity","scope":"UnitDefsLoop","conditions":[{"type":"nameMatch","regex":"calamity"}],"mutations":[{"op":"set","field":"maxThisUnit","value":{"type":"variable","key":"limit"}}]},"tweak_limit_epic_tyrannus":{"name":"Limit Tyrannus","description":"Limits Epic Tyrannus","scope":"UnitDefsLoop","conditions":[{"type":"nameMatch","regex":"tyrannus"}],"mutations":[{"op":"set","field":"maxThisUnit","value":{"type":"variable","key":"limit"}}]},"tweak_limit_epic_starfall":{"name":"Limit Starfall","description":"Limits Epic Starfall","scope":"UnitDefsLoop","conditions":[{"type":"nameMatch","regex":"starfall"}],"mutations":[{"op":"set","field":"maxThisUnit","value":{"type":"variable","key":"limit"}}]},"tweak_enable_unit_launchers":{"name":"Enable Unit Launchers","description":"Adds Unit Launchers to T2 Vehicle Plants","scope":"UnitDefsLoop","conditions":[{"type":"nameInList","names":["armavp","coravp","legavp"]}],"mutations":[{"op":"list_append","field":"buildoptions","value":"armmeatball"},{"op":"list_append","field":"buildoptions","value":"corclogger"}]}}');class m{constructor(){this.builder=[],this.indentLevel=0,this.usedGlobals=new Set}compile(e){this.builder=[],this.indentLevel=0,this.usedGlobals=new Set,this.scanGlobals(e),this.emitGlobals(),this.addStatement("");const t=e.filter(e=>"UnitDefsLoop"===e.tweak.scope),a=e.filter(e=>"UnitDef_Post"===e.tweak.scope),s=e.filter(e=>"Global"===e.tweak.scope);if(s.length>0)for(const e of s)for(const t of e.tweak.mutations)this.generateMutation(t,"nil",e.variables);if(t.length>0){this.startLoop("for id, def in pairs(UnitDefs)"),this.addLocal("name","def.name or id");let e=null;for(const a of t){const t=this.generateConditions(a.tweak.conditions,"name","def",a.variables),s=t.join(" && ");e&&e.conditions.join(" && ")===s?e.inputs.push(a):(e&&this.emitGroup(e,"def"),e={inputs:[a],conditions:t})}e&&this.emitGroup(e,"def"),this.endBlock()}if(a.length>0){const e="ApplyTweaks_Post";this.startBlock(`local function ${e}(name, def)`);let t=null;for(const e of a){const a=this.generateConditions(e.tweak.conditions,"name","def",e.variables),s=a.join(" && ");t&&t.conditions.join(" && ")===s?t.inputs.push(e):(t&&this.emitGroup(t,"def"),t={inputs:[e],conditions:a})}t&&this.emitGroup(t,"def"),this.endBlock(),this.addStatement(""),this.startIf("UnitDef_Post"),this.addLocal("prev_UnitDef_Post","UnitDef_Post"),this.startBlock("UnitDef_Post = function(name, def)"),this.addStatement("prev_UnitDef_Post(name, def)"),this.addStatement(`${e}(name, def)`),this.endBlock(),this.addElse(),this.addStatement(`UnitDef_Post = ${e}`),this.endBlock()}return this.builder.map(e=>e.trim()).filter(e=>""!==e&&!e.startsWith("--")).join("\n")}emitGroup(e,t){e.conditions.length>0&&this.startIf(e.conditions.join(" and "));const a=[];e.inputs.forEach(e=>e.tweak.mutations.forEach(t=>a.push({mut:t,vars:e.variables})));const s=[];for(const e of a){const t=s.length>0?s[s.length-1]:null;t&&"multiply"===t.mut.op&&"multiply"===e.mut.op&&(t.mut.field,e.mut.field),s.push(e)}const n=new Map,o=(e,a)=>{const s=a.join(" * "),n=e.split(".");if("customparams"===n[0].toLowerCase()&&n.length>1){const e=n[1];this.startIf(`${t}.customparams and ${t}.customparams["${e}"]`),this.addStatement(`${t}.customparams["${e}"] = ${t}.customparams["${e}"] * (${s})`),this.addElse(),this.startIf(`${t}.customParams and ${t}.customParams["${e}"]`),this.addStatement(`${t}.customParams["${e}"] = ${t}.customParams["${e}"] * (${s})`),this.endBlock(),this.endBlock()}else this.addStatement(`${t}.${e} = ${t}.${e} * (${s})`)},l=e=>{if(e)n.has(e)&&(o(e,n.get(e)),n.delete(e));else{for(const[e,t]of n)o(e,t);n.clear()}};for(const e of s){const{mut:a,vars:s}=e;if("set"!==a.op&&"assign_math_floor"!==a.op&&"remove"!==a.op||("field"in a&&l(a.field),"target"in a&&l(a.target)),"multiply"===a.op){const e=this.resolveValueSource(a.factor,s);n.has(a.field)||n.set(a.field,[]),n.get(a.field).push(e)}else l(),this.generateMutation(a,t,s)}l(),e.conditions.length>0&&this.endBlock()}generateMutation(e,t,a){if("set"===e.op)this.addFieldWrite(t,e.field,this.resolveValueSource(e.value,a));else if("multiply"===e.op){const s=this.resolveValueSource(e.factor,a);this.addFieldWrite(t,e.field,`${this.getFieldRead(t,e.field)} * (${s})`)}else if("remove"===e.op)this.addFieldWrite(t,e.field,"nil");else if("assign_math_floor"===e.op){const s=this.getFieldRead(t,e.source);this.startIf(s);const n=this.resolveValueSource(e.factor,a);this.addFieldWrite(t,e.target,`math_floor(${s} * ${n})`),this.endBlock()}else if("list_append"===e.op){const s=this.resolveValueSource(e.value,a),n="target_list";this.addLocal(n,this.getFieldRead(t,e.field)),this.startIf(`not ${n}`);const o=e.field.split(".");"customparams"===o[0].toLowerCase()&&o.length>1?(this.addStatement(`${t}.customparams = ${t}.customparams or {}`),this.addStatement(`${t}.customparams["${o[1]}"] = {}`),this.addStatement(`${n} = ${t}.customparams["${o[1]}"]`)):(this.addStatement(`${t}.${e.field} = {}`),this.addStatement(`${n} = ${t}.${e.field}`)),this.endBlock(),this.addStatement(`table_insert(${n}, ${s})`)}else if("modify_weapon"===e.op){const s=e.weaponName||"*";this.startIf(`${t}.weapondefs`),this.startLoop(`for wName, wDef in pairs(${t}.weapondefs)`),"*"!==s&&this.startIf(`wName == "${s}"`);for(const t of e.mutations)this.generateMutation(t,"wDef",a);"*"!==s&&this.endBlock(),this.endBlock(),this.endBlock()}else if("table_merge"===e.op){const s=this.resolveValueSource(e.value,a),n=e.field.split(".");if("customparams"===n[0].toLowerCase()&&n.length>1){const e=n[1];this.addStatement(`if not ${t}.customparams then ${t}.customparams = {} end`),this.addStatement(`if not ${t}.customparams["${e}"] then ${t}.customparams["${e}"] = {} end`),this.addStatement(`table_merge(${t}.customparams["${e}"], ${s})`)}else this.addStatement(`if not ${t}.${e.field} then ${t}.${e.field} = {} end`),this.addStatement(`table_merge(${t}.${e.field}, ${s})`)}else if("list_remove"===e.op){const s=this.resolveValueSource(e.value,a),n="target_list";this.addLocal(n,this.getFieldRead(t,e.field)),this.startIf(n),this.startLoop(`for i = #(${n}), 1, -1`),this.startIf(`${n}[i] == ${s}`),this.addStatement(`table_remove(${n}, i)`),this.endBlock(),this.endBlock(),this.endBlock()}else if("clone_unit"===e.op){const s="SELF"===e.source?t:`UnitDefs["${e.source}"]`,n=e.target?`"${e.target}"`:e.targetSuffix?`${t}.name .. "${e.targetSuffix}"`:"nil";if(this.startIf(s),this.addLocal("newDef",`table_merge({}, ${s})`),e.mutations)for(const t of e.mutations)this.generateMutation(t,"newDef",a);this.addStatement(`UnitDefs[${n}] = newDef`),this.endBlock()}}generateConditions(e,t,a,s){const n=[];for(const o of e)switch(o.type){case"nameMatch":n.push(`string_match(${t}, "${o.regex}")`);break;case"nameNotMatch":n.push(`not string_match(${t}, "${o.regex}")`);break;case"nameStartsWith":if("string"==typeof o.prefix?o.prefix:this.resolveValueSource(o.prefix,s).replace(/"/g,""),"string"!=typeof o.prefix){const e=this.resolveValueSource(o.prefix,s);n.push(`string_sub(${t}, 1, string_len(${e})) == ${e}`)}else n.push(`string_sub(${t}, 1, ${o.prefix.length}) == "${o.prefix}"`);break;case"nameEndsWith":if("string"!=typeof o.suffix){const e=this.resolveValueSource(o.suffix,s);n.push(`string_sub(${t}, -string_len(${e})) == ${e}`)}else n.push(`string_sub(${t}, -${o.suffix.length}) == "${o.suffix}"`);break;case"customParam":const e="object"==typeof o.value?this.resolveValueSource(o.value,s):"string"==typeof o.value?`"${o.value}"`:o.value;n.push(`((${a}.customParams and ${a}.customParams["${o.key}"] == ${e}) or (${a}.customparams and ${a}.customparams["${o.key}"] == ${e}))`);break;case"customParamMatch":n.push(`((${a}.customParams and ${a}.customParams["${o.key}"] and string_match(${a}.customParams["${o.key}"], "${o.regex}")) or (${a}.customparams and ${a}.customparams["${o.key}"] and string_match(${a}.customparams["${o.key}"], "${o.regex}")))`);break;case"fieldValue":const l="object"==typeof o.value?this.resolveValueSource(o.value,s):"string"==typeof o.value?`"${o.value}"`:o.value;n.push(`${this.getFieldRead(a,o.field)} == ${l}`);break;case"category":const i="object"==typeof o.value?this.resolveValueSource(o.value,s):`"${o.value}"`;n.push(`string_match(${a}.category or "", ${i})`);break;case"nameInList":const r=o.names.map(e=>`${t} == "${e}"`);n.push(`(${r.join(" or ")})`)}return n}resolveValueSource(e,t){if("object"==typeof e&&null!==e){if("type"in e){const a=e;if("variable"===a.type){const e=t[a.key];if(void 0===e)throw new Error(`Variable ${a.key} not found`);return this.jsonToLua(e,t)}if("mod_option"===a.type)return`(Spring_GetModOptions().${a.key} or ${this.jsonToLua(a.default,t)})`;if("math"===a.type){let e=a.expression;for(const[s,n]of Object.entries(a.variables)){let a=this.resolveValueSource(n,t);if(a.startsWith('"')&&a.endsWith('"')){const e=a.slice(1,-1);/^[a-zA-Z_][a-zA-Z0-9_.]*$/.test(e)&&(a=e)}e=e.split(s).join(a)}return e=e.replace(/\bmax\(/g,"math_max(").replace(/\bmin\(/g,"math_min(").replace(/\bceil\(/g,"math_ceil(").replace(/\bfloor\(/g,"math_floor(").replace(/\babs\(/g,"math_abs(").replace(/\brandom\(/g,"math_random(").replace(/\bsqrt\(/g,"math_sqrt("),`(${e})`}}return this.jsonToLua(e,t)}return this.jsonToLua(e,t)}jsonToLua(e,t){if(null==e)return"nil";if("object"==typeof e&&null!==e&&"type"in e&&("variable"===e.type||"math"===e.type||"mod_option"===e.type))return this.resolveValueSource(e,t);if("string"==typeof e)return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n")}"`;if("number"==typeof e)return e.toString();if("boolean"==typeof e)return e?"true":"false";if(Array.isArray(e))return`{ ${e.map(e=>this.jsonToLua(e,t)).join(", ")} }`;if("object"==typeof e){const a=[];for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const n=/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(s)?s:`["${s}"]`;a.push(`${n} = ${this.jsonToLua(e[s],t)}`)}return`{ ${a.join(", ")} }`}return"{}"}scanGlobals(e){this.usedGlobals.add("pairs"),this.usedGlobals.add("ipairs"),this.usedGlobals.add("string.sub"),this.usedGlobals.add("string.match"),this.usedGlobals.add("string.len"),this.usedGlobals.add("table.insert"),this.usedGlobals.add("math.floor");for(const t of e)this.scanValueSource(t.tweak,t.variables)}scanValueSource(e,t){if(e&&"object"==typeof e){if("mod_option"===e.type&&this.usedGlobals.add("Spring.GetModOptions"),"math"===e.type){const t=e.expression;t.includes("max(")&&this.usedGlobals.add("math.max"),t.includes("min(")&&this.usedGlobals.add("math.min"),t.includes("ceil(")&&this.usedGlobals.add("math.ceil"),t.includes("floor(")&&this.usedGlobals.add("math.floor"),t.includes("abs(")&&this.usedGlobals.add("math.abs"),t.includes("random(")&&this.usedGlobals.add("math.random"),t.includes("sqrt(")&&this.usedGlobals.add("math.sqrt")}"table_merge"!==e.type&&"clone_unit"!==e.type&&"table_merge"!==e.op&&"clone_unit"!==e.op||this.usedGlobals.add("table.merge"),"list_remove"===e.op&&this.usedGlobals.add("table.remove");for(const a in e)this.scanValueSource(e[a],t)}}emitGlobals(){this.usedGlobals.has("Spring.GetModOptions")&&this.addLocal("Spring_GetModOptions","Spring.GetModOptions"),this.usedGlobals.has("table.merge")&&this.addLocal("table_merge","table.merge");const e={pairs:"pairs",ipairs:"ipairs","string.sub":"string_sub","string.match":"string_match","string.len":"string_len","table.insert":"table_insert","table.remove":"table_remove","math.floor":"math_floor","math.ceil":"math_ceil","math.max":"math_max","math.min":"math_min","math.abs":"math_abs","math.random":"math_random","math.sqrt":"math_sqrt"};for(const t of this.usedGlobals)e[t]&&this.addLocal(e[t],t)}getIndent(){return"    ".repeat(this.indentLevel)}addStatement(e){this.builder.push(this.getIndent()+e)}addLocal(e,t){this.builder.push(`${this.getIndent()}local ${e} = ${t}`)}startLoop(e){this.builder.push(`${this.getIndent()}${e} do`),this.indentLevel++}startIf(e){this.builder.push(`${this.getIndent()}if ${e} then`),this.indentLevel++}addElse(){this.indentLevel--,this.builder.push(`${this.getIndent()}else`),this.indentLevel++}startBlock(e){this.builder.push(`${this.getIndent()}${e}`),this.indentLevel++}endBlock(){this.indentLevel--,this.builder.push(`${this.getIndent()}end`)}getFieldRead(e,t){const a=t.split(".");if("customparams"===a[0].toLowerCase()&&a.length>1){const t=a[1];return`((${e}.customParams and ${e}.customParams["${t}"]) or (${e}.customparams and ${e}.customparams["${t}"]))`}return`${e}.${t}`}addFieldWrite(e,t,a){const s=t.split(".");if("customparams"===s[0].toLowerCase()&&s.length>1){const t=s[1];this.startIf(`${e}.customparams`),this.addStatement(`${e}.customparams["${t}"] = ${a}`),this.addElse(),this.addStatement(`if not ${e}.customParams then ${e}.customParams = {} end`),this.addStatement(`${e}.customParams["${t}"] = ${a}`),this.endBlock()}else this.addStatement(`${e}.${t} = ${a}`)}}const u=d,p=d;function h(e){const t=document.querySelector("#custom-tweaks-table tbody");t.innerHTML="",0!==e.length?e.forEach(e=>{t.insertRow().innerHTML=`<td title="${e.desc}">${e.desc}</td><td title="${e.type}">${e.type}</td><td><div class="command-cell-wrapper"><span class="command-text" title="${e.tweak}">${e.tweak}</span><button class="copy-row-button" data-tweak-code="${e.tweak}">Copy</button></div></td><td><button class="delete-tweak-btn" data-id="${e.id}">Delete</button></td>`}):t.innerHTML='<tr><td colspan="4" style="text-align: center;">No custom tweaks saved</td></tr>'}function f(e){const t=document.querySelector("#data-table tbody");t.innerHTML="",e.filter(e=>"Hidden"!==e.status).forEach(e=>{const a=t.insertRow();a.insertCell().textContent=e.label,a.insertCell().textContent=e.status,a.insertCell().textContent=e.summary;const s=a.insertCell(),n=document.createElement("div");n.className="command-cell-wrapper";const o=document.createElement("span");o.className="command-text",o.textContent=e.commandBlock,o.title=e.commandBlock;const l=document.createElement("button");l.textContent="Copy",l.className="copy-row-button",l.dataset.command=e.commandBlock,n.appendChild(o),n.appendChild(l),s.appendChild(n)}),document.querySelectorAll("select[data-slot]").forEach(e=>{const a=e,s=a.value;if(!s)return;const n=a.options[a.selectedIndex].text,o=a.dataset.hpType,l=a.dataset.slot,i=`${a.dataset.slotType}${l}`,r=function(e,t){const a=parseFloat(t);if(isNaN(a))return"Error: Invalid multiplier";try{const s=[];if("qhp"===e)p.qhp&&s.push({tweak:p.qhp,variables:{multiplier:a,multiplierText:t}});else if("boss"===e)p.boss_hp&&s.push({tweak:p.boss_hp,variables:{multiplier:a,multiplierText:t}});else if("hp"===e){let e=1,n=.5;switch(a){case 1.3:e=.576923077,n=.5;break;case 1.5:e=.466666667,n=.5;break;case 1.7:e=.411764706,n=.5;break;case 2:e=.35,n=.5;break;case 2.5:e=.3,n=.6;break;case 3:e=.25,n=.55;break;case 4:e=.1875,n=.45;break;case 5:e=.15,n=.25;break;default:e=1,n=.5}p.raptor_swarmer_heal&&s.push({tweak:p.raptor_swarmer_heal,variables:{workertimeMultiplier:n,multiplierText:t}}),p.raptor_health&&s.push({tweak:p.raptor_health,variables:{healthMultiplier:a,multiplierText:t}}),p.raptor_metal_chase&&s.push({tweak:p.raptor_metal_chase,variables:{metalCostFactor:e,multiplierText:t}})}else{if("scav"!==e)return"Error: Unknown type";p.scav_hp_health&&s.push({tweak:p.scav_hp_health,variables:{multiplier:a,multiplierText:t}}),p.scav_hp_metal&&s.push({tweak:p.scav_hp_metal,variables:{multiplier:a,multiplierText:t}})}if(s.length>0){const e=(new m).compile(s);let t=e;if("undefined"!=typeof luamin){const a=e.match(/^(--.*)\n/),s=a?a[1]:"",n=luamin.minify(e);t=s?s+"\n"+n:n}return function(e){const t=unescape(encodeURIComponent(e));return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}(t)}}catch(e){return"Error: "+e}return"Error: Unknown type"}(o,s);if(r.startsWith("Error"))return;const c=`!bset ${i} ${r}`,d=function(e){if(!e)return"";try{let t=e.replace(/-/g,"+").replace(/_/g,"/");const a=t.length%4;a&&(t+="====".slice(a));const s=atob(t),n=Uint8Array.from(s,e=>e.charCodeAt(0));return new TextDecoder("utf-8").decode(n)}catch(t){return console.error(`Base64URL decoding failed for: ${e}`,t),"Error decoding data"}}(r).split("\n")[0].trim(),u=t.insertRow();u.insertCell().textContent=n,u.insertCell().textContent="Optional/Generated",u.insertCell().textContent=d;const h=u.insertCell(),f=document.createElement("div");f.className="command-cell-wrapper";const b=document.createElement("span");b.className="command-text",b.textContent=c,b.title=c;const v=document.createElement("button");v.textContent="Copy",v.className="copy-row-button",v.dataset.command=c,f.appendChild(b),f.appendChild(v),h.appendChild(f)})}let b=[],v=[],y={maps:[],modes:[],base:[],scavengers:[]};const g=document.getElementById("lobby-name-display"),k=(document.querySelectorAll(".copy-button"),document.querySelector("#data-table tbody")),x=document.getElementById("custom-tweak-form"),_=document.querySelector("#custom-tweaks-table tbody"),w=document.querySelector("#maps-modes-table tbody"),$=document.querySelectorAll(".tab-button"),S=document.querySelectorAll(".tab-content"),C=document.getElementById("reset-none-btn"),E=document.getElementById("reset-default-btn"),L=document.getElementById("options-form-columns");function T(e){const t=document.getElementById("primary-mode-select"),a=document.getElementById("raptor-only-options"),s=document.getElementById("scav-only-options"),n=document.getElementById("scav-hp-select"),o=document.getElementById("boss-hp-select"),l=document.getElementById("maps-select"),i=document.getElementById("modes-select");if(t&&a&&s){const l=t.value;e&&e.target===t&&("Scavengers"===l?(n.value="1.3",o.value="1.3",a.querySelectorAll("select, input").forEach(e=>e.value="")):(n.value="",o.value="",a.querySelectorAll("select, input").forEach(e=>{const t=e;let a=v.find(e=>e.label===t.dataset.optionType);!a&&t.dataset.modOption&&(a=v.find(e=>e.modOption===t.dataset.modOption)),!a&&t.dataset.tweakTemplateId&&(a=v.find(e=>e.tweakTemplateId===t.dataset.tweakTemplateId)),a&&(e.value=a.defaultValue||"")})));const i="Scavengers"===l;a.style.display=i?"none":"block",s.style.display=i?"block":"none"}!function(){const e=document.getElementById("slot-warning-messages"),t=new Set,a=new Set,s=/!bset\s+(tweakdefs|tweakunits)([1-9])\b/;document.querySelectorAll('#options-form-columns input[type="checkbox"], #options-form-columns select').forEach(e=>{const n=e;if(n.dataset.isCustom)return;if((n.dataset.isHpGenerator||n.dataset.isScavHpGenerator)&&n.value&&n.dataset.slot){const e=parseInt(n.dataset.slot,10);return void(isNaN(e)||("tweakdefs"===n.dataset.slotType?t.add(e):"tweakunits"===n.dataset.slotType&&a.add(e)))}let o=[];"SELECT"===n.tagName&&n.value?o.push(n.value):"checkbox"===n.type&&n.checked&&(o=JSON.parse(n.dataset.commandBlocks||"[]")),o.forEach(e=>{if(!e)return;const n=e.match(s);if(n){const e=parseInt(n[2],10);"tweakdefs"===n[1]?t.add(e):"tweakunits"===n[1]&&a.add(e)}})});const n=document.querySelectorAll('input[data-is-custom="true"]');n.forEach(e=>{const s=e,n=s.nextElementSibling.nextElementSibling,o=s.nextElementSibling,l=JSON.parse(s.dataset.customData);if(o.classList.remove("disabled"),s.checked){const e="tweakdefs"===l.type?t:a;let s=null;for(let t=1;t<=9;t++)if(!e.has(t)){s=t;break}null!==s?(n.textContent=`(${l.type}${s})`,e.add(s)):n.textContent=`(${l.type} - No Slot!)`}else n.textContent=`(${l.type})`});let o=9-t.size,l=9-a.size;n.forEach(e=>{const t=e;if(!t.checked){const e=JSON.parse(t.dataset.customData);let a=!1;"tweakdefs"===e.type&&o<=0&&(a=!0),"tweakunits"===e.type&&l<=0&&(a=!0),t.disabled=a,t.nextElementSibling.classList.toggle("disabled",a)}}),e.innerHTML="";const i=1===Math.max(0,o)?"slot":"slots",r=1===Math.max(0,l)?"slot":"slots",c=document.createElement("p");c.textContent=`${Math.max(0,o)} available tweakdefs ${i} and ${Math.max(0,l)} available tweakunits ${r}`,e.appendChild(c)}();const r=Array.from(document.querySelectorAll('#options-form-columns input[type="checkbox"], #options-form-columns input[type="number"], #options-form-columns select, #custom-options-form-columns input[type="checkbox"]')).map(e=>{const t=e;return{isCustom:"true"===t.dataset.isCustom,customData:t.dataset.customData?JSON.parse(t.dataset.customData):void 0,isHpGenerator:"true"===t.dataset.isHpGenerator,isScavHpGenerator:"true"===t.dataset.isScavHpGenerator,value:t.value,checked:t.checked,hpType:t.dataset.hpType,slot:t.dataset.slot,slotType:t.dataset.slotType,tagName:t.tagName,id:t.id,dataset:t.dataset,commandBlocks:t.dataset.commandBlocks?JSON.parse(t.dataset.commandBlocks):void 0}}),c=Array.from(document.querySelectorAll("#raptor-only-options select")).map(e=>({value:e.value,optionType:e.dataset.optionType||""})),d=function(e){const{gameConfigs:t,formOptionsConfig:a,mapsSelectValue:s,modesSelectValue:n,primaryModeSelectValue:o,scavHpSelectValue:l,scavHpSelectText:i,bossHpSelectValue:r,bossHpSelectText:c,formElements:d,raptorOptions:p}=e,h=[];if(""!==s){const e=t.maps[parseInt(s)];e&&e.commands&&h.push(...e.commands)}if(""!==n){const e=t.modes[parseInt(n)];e&&e.commands&&h.push(...e.commands)}const f=[],b=[],v=[];if(d.forEach(e=>{if(e.isCustom)e.checked&&e.customData&&b.push(e.customData);else if(e.tweakDefinition&&e.checked)v.push({tweak:e.tweakDefinition,variables:{}});else if(e.isHpGenerator||e.isScavHpGenerator){const t=parseFloat(e.value||"0");if(t>0){const a=e.hpType;if("qhp"===a)u.qhp&&v.push({tweak:u.qhp,variables:{multiplier:t,multiplierText:e.value}});else if("hp"===a){let a=1,s=.5;switch(t){case 1.3:a=.576923077,s=.5;break;case 1.5:a=.466666667,s=.5;break;case 1.7:a=.411764706,s=.5;break;case 2:a=.35,s=.5;break;case 2.5:a=.3,s=.6;break;case 3:a=.25,s=.55;break;case 4:a=.1875,s=.45;break;case 5:a=.15,s=.25;break;default:a=1,s=.5}u.raptor_swarmer_heal&&v.push({tweak:u.raptor_swarmer_heal,variables:{workertimeMultiplier:s,multiplierText:e.value}}),u.raptor_health&&v.push({tweak:u.raptor_health,variables:{healthMultiplier:t,multiplierText:e.value}}),u.raptor_metal_chase&&v.push({tweak:u.raptor_metal_chase,variables:{metalCostFactor:a,multiplierText:e.value}})}else"boss"===a?u.boss_hp&&v.push({tweak:u.boss_hp,variables:{multiplier:t,multiplierText:e.value}}):"scav"===a&&(u.scav_hp_health&&v.push({tweak:u.scav_hp_health,variables:{multiplier:t,multiplierText:e.value}}),u.scav_hp_metal&&v.push({tweak:u.scav_hp_metal,variables:{multiplier:t,multiplierText:e.value}}))}}else{let t=[];if("SELECT"!==e.tagName||e.id.includes("maps-select")||e.id.includes("modes-select")||e.id.includes("primary-mode-select")?e.checked&&e.commandBlocks&&(t=e.commandBlocks):e.value&&t.push(e.value),e.dataset.tweakTemplateId){const t=e.dataset.tweakTemplateId;if(u[t]){let a={};if(e.dataset.tweakVars)try{a=JSON.parse(e.dataset.tweakVars)}catch(e){console.error("Error parsing tweakVars JSON:",e)}else e.dataset.tweakVar&&e.value&&(a={[e.dataset.tweakVar]:parseFloat(e.value)||e.value});v.push({tweak:u[t],variables:a})}}e.dataset.modOption&&e.value&&t.push(`!bset ${e.dataset.modOption} ${e.value}`),t.forEach(e=>{e&&f.push(e.trim())})}}),v.length>0){const e=(new m).compile(v),t={valid:!0};if(t.valid){const t=unescape(encodeURIComponent(e)),a=btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");b.unshift({id:0,desc:"Optimized Config",type:"tweakdefs",tweak:a})}else console.error(`Lua validation failed for generated config: ${t.error}`)}const y=new Set,g=new Set,k=/!bset\s+(tweakdefs|tweakunits)([1-9])\b/;[...f].forEach(e=>{const t=e.match(k);if(t){const e=parseInt(t[2],10);"tweakdefs"===t[1]?y.add(e):"tweakunits"===t[1]&&g.add(e)}});const x=[];b.forEach(e=>{const t="tweakdefs"===e.type?y:g;let a=null;for(let e=1;e<=9;e++)if(!t.has(e)){a=e;break}null!==a?(x.push(`!bset ${e.type}${a} ${e.tweak}`),t.add(a)):console.warn(`All slots for '${e.type}' are full. Could not add custom tweak.`)});const _=h.length>0||f.length>0||x.length>0,w=[];(h.length>0||f.length>0||x.length>0)&&(t.base.length>0&&w.push(...t.base),"Scavengers"===o&&t.scavengers.length>0&&w.push(...t.scavengers)),w.push(...h,...f,...x);const $="Scavengers"===o;let S=$?"$rename [Mod] NuttyB Scavengers ":"$rename [Mod] NuttyB Raptors ";const C=[];if($){const e=[i,c].filter(Boolean).join(" ");if(e){const t=e.replace(/\./g,"_");C.push(`[${t}]`)}}else{let e="",t="",s="";p.forEach(n=>{if(n.value){const o=a.find(e=>e.label===n.optionType);if(o&&o.choices){const a=o.choices.find(e=>e.value===n.value);a&&void 0!==a.shortLabel&&("Extras"===o.label?e=a.shortLabel:"Raptor Health"===o.label?t=a.shortLabel:"Queen Health"===o.label&&(s=a.shortLabel))}}}),e&&C.push(e);const n=[s,t].filter(Boolean).join(" ");n&&C.push(`[${n}]`)}const E=w.lastIndexOf("!unit_restrictions_noextractors 1"),L=w.lastIndexOf("!unit_restrictions_noextractors 0"),T=E>-1&&E>L;C.length>0&&(S+=C.join("")),T&&(S+="[No Mex]");const B=[],H=w;for(const e of H){if(!e)continue;let t=!1;for(const a of B){const s=0===a.length?e.length:e.length+1;if(a.length+s<=5e4){a.commands.push(e),a.length+=s,t=!0;break}}t||B.push({commands:[e],length:e.length})}if(_)if(0===B.length)B.push({commands:[S],length:S.length});else{const e=B[B.length-1],t=0===e.length?S.length:S.length+1;e.length+t<=5e4?(e.commands.push(S),e.length+=t):B.push({commands:[S],length:S.length})}return{lobbyName:_?S:"No Options Selected",sections:B.map(e=>e.commands.join("\n"))}}({gameConfigs:y,formOptionsConfig:v,mapsSelectValue:l?l.value:"",modesSelectValue:i?i.value:"",primaryModeSelectValue:t?t.value:"Raptors",scavHpSelectValue:n?n.value:"",scavHpSelectText:n&&n.options[n.selectedIndex]?n.options[n.selectedIndex].text:"",bossHpSelectValue:o?o.value:"",bossHpSelectText:o&&o.options[o.selectedIndex]?o.options[o.selectedIndex].text:"",formElements:r,raptorOptions:c});g.textContent=d.lobbyName;for(let e=1;e<=7;e++){const t=document.getElementById(`part-${e}-section`),a=document.getElementById(`command-output-${e}`);d.sections[e-1]?(a.value=d.sections[e-1],t.style.display="grid"):(a.value="",t.style.display="none")}}function B(e){const t=e.target,a=t.dataset.tab+"-tab";$.forEach(e=>e.classList.remove("active")),S.forEach(e=>e.classList.remove("active")),t.classList.add("active"),document.getElementById(a).classList.add("active"),"data"===t.dataset.tab&&(f(b),function(e){const t=document.querySelector("#maps-modes-table tbody");if(t.innerHTML="",0===e.maps.length&&0===e.modes.length&&0===e.scavengers.length&&0===e.base.length)return void(t.innerHTML='<tr><td colspan="3" style="text-align: center;">No maps or modes found.</td></tr>');const a=(e,t)=>{if(!t||0===t.length)return void(e.textContent="N/A");const a=document.createElement("div");a.className="command-cell-wrapper";const s=document.createElement("span");s.style.whiteSpace="normal",s.innerHTML=t.join("<br>");const n=document.createElement("button");n.textContent="Copy All",n.className="copy-row-button",n.dataset.command=t.join("\n"),a.appendChild(s),a.appendChild(n),e.appendChild(a)},s=(e,s)=>{e.forEach(e=>{const n=t.insertRow();n.insertCell().textContent=s,n.insertCell().textContent=e.name,a(n.insertCell(),e.commands)})},n=(e,s,n)=>{if(e.length>0){const o=t.insertRow();o.insertCell().textContent=s,o.insertCell().textContent=n,a(o.insertCell(),e)}};n(e.base,"base","Raptors (Default)"),n(e.scavengers,"scavengers","Default"),s(e.maps,"maps"),s(e.modes,"modes")}(y)),"custom"===t.dataset.tab&&h(c())}function H(){h(c()),function(e,t){const a=document.getElementById("custom-left-column"),s=document.getElementById("custom-right-column"),n=document.getElementById("custom-settings-container");a.innerHTML="",s.innerHTML="",e.length>0?(n.style.display="block",e.forEach((e,n)=>{const o=document.createElement("label"),l=document.createElement("input");l.type="checkbox",l.dataset.isCustom="true",l.dataset.customData=JSON.stringify({type:e.type,tweak:e.tweak}),l.addEventListener("change",t);const i=document.createElement("span");i.className="custom-option-label-text",i.textContent=` ${e.desc}`;const r=document.createElement("span");r.className="custom-option-type-display",r.textContent=`(${e.type})`,o.appendChild(l),o.appendChild(i),o.appendChild(r),n%2==0?a.appendChild(o):s.appendChild(o)})):n.style.display="none"}(c(),T)}document.addEventListener("click",e=>{const t=e.target;if(t.matches(".copy-button")){const e=t.dataset.target;if(!e)return;const a=document.getElementById(e);if(!a)return;const s=t.textContent;navigator.clipboard.writeText(a.value).then(()=>{t.textContent="Copied!",setTimeout(()=>{t.textContent=s},2e3)}).catch(e=>{console.error("Failed to copy: ",e)})}}),[k,_,w].forEach(e=>{e&&e.addEventListener("click",e=>{const t=e.target;if(t.matches(".copy-row-button")){const e=t.dataset.command||t.dataset.tweakCode;if(!e)return;navigator.clipboard.writeText(e).then(()=>{const e=t.textContent;t.textContent="Copied!",setTimeout(()=>{t.textContent=e},2e3)}).catch(e=>{console.error("Failed to copy command: ",e)})}else t.matches(".delete-tweak-btn")&&(function(e){i=i.filter(t=>t.id!==e),r(i)}(parseInt(t.dataset.id,10)),H(),T())})}),C.addEventListener("click",()=>{document.querySelectorAll('#options-form-columns input[type="checkbox"], #options-form-columns input[type="number"], #options-form-columns select').forEach(e=>{const t=e;if("checkbox"===t.type)t.checked=!1;else if("SELECT"===t.tagName)"maps-select"===t.id||"modes-select"===t.id?t.selectedIndex=-1:"primary-mode-select"!==t.id&&(t.value="");else if("number"===t.type){const e=t.dataset.tweakTemplateId;if(e){const a=v.find(t=>t.tweakTemplateId===e);t.value=a&&a.defaultValue||""}else t.value=""}}),T()}),E.addEventListener("click",()=>{const e=document.getElementById("primary-mode-select");e&&(e.value="Raptors");const t=new Map;document.querySelectorAll("#options-form-columns label").forEach(e=>{var a;const s=null===(a=e.textContent)||void 0===a?void 0:a.trim();s&&t.set(s,e)}),v.forEach(e=>{if("checkbox"===e.type){const a=t.get(e.label);if(a){const t=a.querySelector('input[type="checkbox"]');t&&(t.checked=!!e.default)}}else if("select"===e.type){const t=L.querySelector(`select[data-option-type="${e.label}"]`);t&&(t.value=e.defaultValue||"")}else if("numeric-tweak"===e.type&&e.tweakTemplateId){const t=L.querySelector(`input[data-tweak-template-id="${e.tweakTemplateId}"]`);t&&(t.value=e.defaultValue||"")}});const a=document.getElementById("boss-hp-select"),s=document.getElementById("scav-hp-select");a&&(a.value=""),s&&(s.value="");const n=document.getElementById("maps-select");n&&n.options.length>0&&(n.selectedIndex=0);const o=document.getElementById("modes-select");o&&o.options.length>0&&(o.selectedIndex=0),T()}),x.addEventListener("submit",function(e){var t,a,s;e.preventDefault(),t=document.getElementById("custom-option-desc").value.trim(),a=document.getElementById("custom-option-type").value,s=document.getElementById("custom-tweak-code").value.trim(),t&&s&&(i.push({id:Date.now(),desc:t,type:a,tweak:s}),r(i)),H(),T(),x.reset()}),$.forEach(e=>e.addEventListener("click",B)),document.addEventListener("DOMContentLoaded",function(){return e=this,t=void 0,r=function*(){try{!function(){const e=localStorage.getItem(l);i=e?JSON.parse(e):[]}();const[e,t,a]=yield Promise.all([o(),s(),n()]);if(y=e,b=t.rawOptionsData,v=t.formOptionsConfig,a){const e=document.getElementById("links-tab");e&&(e.innerHTML=a)}console.log("Modes file loaded and parsed:",y),function(e,t,a){const s=document.getElementById("left-column"),n=document.getElementById("right-column");document.getElementById("options-form-columns"),s.innerHTML="",n.innerHTML="";const o=new Map(e.map(e=>[e.label,e])),l=["NuttyB Main Tweaks","NuttyB Evolving Commanders"],i=new Set(l);l.forEach(e=>{const t=o.get(e);if(t){const e=document.createElement("label"),n=document.createElement("input");n.type="checkbox",n.dataset.commandBlocks=JSON.stringify(t.commandBlocks),t.tweakTemplateId&&(n.dataset.tweakTemplateId=t.tweakTemplateId),n.checked=!!t.default,n.disabled=!!t.disabled,e.appendChild(n),e.appendChild(document.createTextNode(" "+t.label)),n.disabled||n.addEventListener("change",a),s.appendChild(e)}});const r=document.createElement("label");r.textContent="Mode: ";const c=document.createElement("select");c.id="primary-mode-select",c.innerHTML='<option value="Raptors">Raptors</option><option value="Scavengers">Scavengers</option>',c.addEventListener("change",e=>a(e)),r.appendChild(c),s.appendChild(r);const d=document.createElement("div");d.id="scav-only-options";const m=document.createElement("label");m.textContent="Scavengers HP: ";const u=document.createElement("select");u.id="scav-hp-select",u.dataset.isScavHpGenerator="true",u.dataset.hpType="scav",u.dataset.slot="",u.dataset.slotType="tweakdefs",[{v:"",t:"Default"},{v:"1",t:"1x HP"},{v:"1.3",t:"1.3x HP"},{v:"1.5",t:"1.5x HP"},{v:"1.7",t:"1.7x HP"},{v:"2",t:"2x HP"},{v:"2.5",t:"2.5x HP"},{v:"3",t:"3x HP"},{v:"4",t:"4x HP"},{v:"5",t:"5x HP"}].forEach(e=>u.add(new Option(e.t,e.v))),u.value="",u.addEventListener("change",a),m.appendChild(u),d.appendChild(m);const p=document.createElement("label");p.textContent="Scav Boss HP: ";const h=document.createElement("select");h.id="boss-hp-select",h.dataset.isScavHpGenerator="true",h.dataset.hpType="boss",h.dataset.slot="1",h.dataset.slotType="tweakdefs",[{v:"",t:"Default"},{v:"1",t:"1x BHP"},{v:"1.3",t:"1.3x BHP"},{v:"1.5",t:"1.5x BHP"},{v:"1.7",t:"1.7x BHP"},{v:"2",t:"2x BHP"},{v:"2.5",t:"2.5x BHP"},{v:"3",t:"3x BHP"},{v:"4",t:"4x BHP"},{v:"5",t:"5x BHP"}].forEach(e=>h.add(new Option(e.t,e.v))),h.value="",h.addEventListener("change",a),p.appendChild(h),d.appendChild(p),s.appendChild(d);const f=document.createElement("div");if(f.id="raptor-only-options",s.appendChild(f),e.forEach(e=>{var t;if(i.has(e.label))return;if("Scavengers HP"===e.label||"Boss HP"===e.label)return;const o=new Set(["Raptor Health","Queen Health","Extras","Raptor Settings","Queen Quantity","Wave Multiplier","First Waves Boost","Grace Period Multiplier"]);if("header"===e.type){const t=document.createElement("h3");return t.textContent=e.label,void(o.has(e.label)||"Raptor Settings"===e.label?f.appendChild(t):"right"===e.column?n.appendChild(t):s.appendChild(t))}const l=document.createElement("label");let r;"checkbox"===e.type?(r=document.createElement("input"),r.type="checkbox",r.dataset.commandBlocks=JSON.stringify(e.commandBlocks),e.tweakTemplateId&&(r.dataset.tweakTemplateId=e.tweakTemplateId),r.checked=!!e.default,r.disabled=!!e.disabled,l.appendChild(r),l.appendChild(document.createTextNode(" "+e.label)),r.disabled||r.addEventListener("change",a)):"numeric-tweak"===e.type?(r=document.createElement("input"),r.type="number",void 0!==e.min&&(r.min=String(e.min)),void 0!==e.max&&(r.max=String(e.max)),void 0!==e.step&&(r.step=String(e.step)),r.value=e.defaultValue||"",e.tweakTemplateId&&(r.dataset.tweakTemplateId=e.tweakTemplateId),e.tweakVar&&(r.dataset.tweakVar=e.tweakVar),e.modOption&&(r.dataset.modOption=e.modOption),l.textContent=e.label+": ",l.appendChild(r),e.unitLabel&&l.appendChild(document.createTextNode(" "+e.unitLabel)),r.addEventListener("input",a)):"select"===e.type&&(r=document.createElement("select"),r.dataset.optionType=e.label,e.isHpGenerator&&(r.dataset.isHpGenerator="true",r.dataset.hpType=e.hpType,r.dataset.slot=String(e.slot),r.dataset.slotType=e.slotType,r.disabled=!0),null===(t=e.choices)||void 0===t||t.forEach(t=>{const a=document.createElement("option");a.value=t.value,a.textContent=t.label,e.defaultValue&&t.value===e.defaultValue&&(a.selected=!0),a.dataset.shortLabel=t.shortLabel||"",r.appendChild(a)}),l.textContent=e.label+": ",l.appendChild(r),r.addEventListener("change",a)),"right"===e.column?n.appendChild(l):o.has(e.label)?f.appendChild(l):s.appendChild(l)}),t&&(t.maps.length>0||t.modes.length>0)){let e,n;if(t.maps.length>0){e=document.createElement("label"),e.textContent="Map: ";const s=document.createElement("select");s.id="maps-select",t.maps.forEach((e,t)=>{s.add(new Option(e.name,String(t)))}),s.selectedIndex=0,s.addEventListener("change",a),e.appendChild(s)}if(t.modes.length>0){n=document.createElement("label"),n.textContent="Start: ";const e=document.createElement("select");e.id="modes-select",e.addEventListener("change",a),n.appendChild(e)}const o=document.getElementById("raptor-only-options");o?(n&&o.after(n),e&&o.after(e)):(e&&s.appendChild(e),n&&s.appendChild(n))}}(v,y,T);const r=setInterval(()=>{"undefined"!=typeof luamin&&(clearInterval(r),console.log("Lua libraries loaded."),document.querySelectorAll('select[data-is-hp-generator="true"], select[data-is-scav-hp-generator="true"]').forEach(e=>{e.disabled=!1}),T())},100);H(),function(e,t){const a=document.getElementById("modes-select");if(!a)return;const s=a.value;a.innerHTML="",e&&e.modes&&(e.modes.forEach((e,t)=>{const s=document.createElement("option");s.value=String(t),s.textContent=e.name,a.appendChild(s)}),Array.from(a.options).some(e=>e.value===s)?a.value=s:a.options.length>0&&(a.selectedIndex=0)),t()}(y,T);const c=document.getElementById("reset-output");c&&(c.value=Array.from({length:9},(e,t)=>`!bset tweakdefs${t+1} ""\n!bset tweakunits${t+1} ""`).join("\n"))}catch(e){console.error("Failed to initialize the configurator:",e),document.querySelector(".container").innerHTML='<h1>Initialization Error</h1><p style="color: red;">Could not load essential configuration files (e.g., modes.txt or tweakdata.txt). Please check that the files exist and refresh the page.</p>'}},new((a=void 0)||(a=Promise))(function(s,n){function o(e){try{i(r.next(e))}catch(e){n(e)}}function l(e){try{i(r.throw(e))}catch(e){n(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,l)}i((r=r.apply(e,t||[])).next())});var e,t,a,r})})();